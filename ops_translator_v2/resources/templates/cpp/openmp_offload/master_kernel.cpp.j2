{% extends "cpp/master_kernel.cpp.j2" %}

{% block ops_headers %}
{{super()}}

{% if user_types %}
#include "user_types.h"
{% endif %}
{% endblock %}

{% block initializaion %}
{{super()}}
{% endblock %}

{% block const_decls %}
//  global constants
    {% for const in app.consts() %}
    {% if const.dim.isdigit() %}
        {% set NDIM = const.dim|int %}
            {% if NDIM > 1 %}
extern {{const.typ}} {{const.ptr}}[{{NDIM}}];
            {% else %}
extern {{const.typ}} {{const.ptr}};
            {% endif %}
    {% else %}
extern {{const.typ}} *{{const.ptr}};
    {% endif %}
    {% endfor %}

void ops_init_backend(){}

void ops_decl_const_char(OPS_instance *instance, int dim, char const *type, int size, char *dat, char const *name) {
    ops_execute(instance);

{% for const in app.consts() %}
    if(!strcmp(name, "{{const.ptr}}")) {
    {% if const.dim.isdigit() and const.dim|int == 1 %}
        #pragma omp target enter data map(to:{{const.ptr}})
    {% else %}
        #pragma omp target enter data map(to:{{const.ptr}}[0:dim])
    {% endif %}
    } else
{% endfor %}
    {
        throw OPSException(OPS_RUNTIME_ERROR, "error: unknown const name");
    }
}
{% endblock %}

{% block header_includes %}
{{super()}}
{% endblock %}
