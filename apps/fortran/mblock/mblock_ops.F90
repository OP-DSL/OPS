!
! auto-generated by ops_fortran.py
!


















program MBLOCK
  use OPS_Fortran_Declarations
  use OPS_Fortran_RT_Support
  use MBLOCK_POPULATE_KERNEL_MODULE
  use OPS_CONSTANTS

  use, intrinsic :: ISO_C_BINDING

  implicit none

  type(ops_block) :: grid0, grid1

  integer S2D_00_array(2) /0,0/
  type(ops_stencil) :: S2D_00

  type(ops_dat) :: data0, data1

  integer d_p(2) /2,2/
  integer d_m(2) /-2,-2/

  integer base(2) /1,1/

  integer size(2) /20,20/


  real(8), dimension(:), allocatable :: temp

  type(ops_halo) :: h0, h1
  type(ops_halo) , DIMENSION(2) :: grp_1, grp_2, grp_3, grp_4, grp_5

  type(ops_halo_group) :: halos1, halos2, halos3, halos4, halos5

  integer halo_iter(2), base_from(2), base_to(2), dir(2), dir_to(2)




  integer iter_range(4)



  call ops_init(2)


  call ops_decl_block(2, grid0, "grid0")
  call ops_decl_block(2, grid1, "grid1")

  call ops_decl_stencil( 2, 1, S2D_00_array, S2D_00, "00")

  call ops_decl_dat(grid0, 1, size, base, d_m, d_p, temp, data0, "double", "data0")
  call ops_decl_dat(grid1, 1, size, base, d_m, d_p, temp, data1, "double", "data1")



  halo_iter(1) = 2
  halo_iter(2) = 20
  base_from(1) = 18
  base_from(2) = 0
  base_to(1) = -2
  base_to(2) = 0
  dir(1) = 1
  dir(2) = 2
  call ops_decl_halo(data0, data1, halo_iter, base_from, base_to, dir, dir, h0)
  base_from(1) = 0
  base_to(1) = 20
  call ops_decl_halo(data1, data0, halo_iter, base_from, base_to, dir, dir, h1)
  grp_1(1) = h0
  grp_1(2) = h1
  call ops_decl_halo_group(2,grp_1, halos1)




  halo_iter(1) = 20
  halo_iter(2) = 2
  base_from(1) = 0
  base_from(2) = 18
  base_to(1) = 0
  base_to(2) = -2
  dir(1) = 1
  dir(2) = 2
  call ops_decl_halo(data0, data1, halo_iter, base_from, base_to, dir, dir, h0)
  base_from(2) = 0
  base_to(2) = 20
  call ops_decl_halo(data1, data0, halo_iter, base_from, base_to, dir, dir, h1)
  grp_2(1) = h0
  grp_2(2) = h1
  call ops_decl_halo_group(2,grp_2,halos2)



  halo_iter(1) = 2
  halo_iter(2) = 20
  base_from(1) = 0
  base_from(2) = 0
  base_to(1) = 20
  base_to(2) = 0
  dir(1) = 1
  dir(2) = 2
  dir_to(1) = 1
  dir_to(2) = -2
  call ops_decl_halo(data0, data1, halo_iter, base_from, base_to, dir, dir_to, h0)
  base_from(1) = 18
  base_to(1) = -2
  call ops_decl_halo(data1, data0, halo_iter, base_from, base_to, dir_to, dir,h1)
  grp_3(1) = h0
  grp_3(2) = h1
  call ops_decl_halo_group(2,grp_3,halos3)



  halo_iter(1) = 20
  halo_iter(2) = 2
  base_from(1) = 0
  base_from(2) = 0
  base_to(1) = 0
  base_to(2) = 20
  dir(1) = 1
  dir(2) = 2
  dir_to(1) = -1
  dir_to(2) = 2
  call ops_decl_halo(data0, data1, halo_iter, base_from, base_to, dir, dir_to, h0)
  base_from(2) = 18
  base_to(2) = -2
  call ops_decl_halo(data1, data0, halo_iter, base_from, base_to, dir_to, dir, h1)
  grp_4(1) = h0
  grp_4(2) = h1
  call ops_decl_halo_group(2,grp_4,halos4)



  halo_iter(1) = 2
  halo_iter(2) = 20
  base_from(1) = 18
  base_from(2) = 0
  base_to(1) = 0
  base_to(2) = -2
  dir(1) = 1
  dir(2) = 2
  dir_to(1) = 2
  dir_to(2) = 1
  call ops_decl_halo(data0, data1, halo_iter, base_from, base_to, dir, dir_to, h0)
  base_from(1) = 0
  base_to(1) = 20
  base_to(2) = 0
  call ops_decl_halo(data1, data0, halo_iter, base_from, base_to, dir_to, dir, h1)
  grp_5(1) = h0
  grp_5(2) = h1
  call ops_decl_halo_group(2,grp_5,halos5)



  call ops_partition("1D_BLOCK_DECOMPOSE")


  iter_range(1) =  1
  iter_range(2) =  20
  iter_range(3) =  1
  iter_range(4) =  20
  call mblock_populate_kernel_host("mblock_populate_kernel", grid0, 2, iter_range, &
                    & ops_arg_dat(data0, 1, S2D_00, "real(8)", OPS_WRITE), &
                    & ops_arg_idx())

  call mblock_populate_kernel_host("mblock_populate_kernel", grid1, 2, iter_range, &
                    & ops_arg_dat(data1, 1, S2D_00, "real(8)", OPS_WRITE), &
                    & ops_arg_idx())





  call ops_halo_transfer(halos4)

  call ops_print_dat_to_txtfile(data0, "data0.txt")
  call ops_print_dat_to_txtfile(data1, "data1.txt")

  call ops_exit( )
end program MBLOCK